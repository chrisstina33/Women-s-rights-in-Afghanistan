<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Petitions for women's rights in Afghanistan</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>

  <style>
    #thankYouMessage {
    display: none;
}
    /* Stilurile tale, neschimbate în esență */
    .zoom-container {
      width: 300px;
      overflow: hidden;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    .imgsrc {
      border-radius: 15px;
      transition: transform 0.3s ease;
      cursor: pointer;
    }

    .imgsrc:hover {
      transform: scale(1.05);
    }

    body {
      font-family: 'Arial', sans-serif;
      background-color: #f7f7f7;
      margin: 0;
      padding: 0;
      text-align: center;
    }

    .header {
      background: url('https://images.unsplash.com/photo-1607082350920-f53bc97fd0ed?ixlib=rb-4.0.3&auto=format&fit=crop&w=1650&q=80') no-repeat center center;
      background-size: cover;
      height: 200px;
    }

    .container {
      max-width: 600px;
      margin: 2rem auto;
      padding: 2rem;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    h1 {
      color: #f84d64;
      font-family: "Times New Roman", Times, serif;
    }

    p {
      color: #ff0202;
      font-family: "Times New Roman", Times, serif;
    }

    button {
      padding: 10px 20px;
      background-color: #fa2105;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      font-family: "Times New Roman", Times, serif;
    }

    button:hover {
      background-color: olive;
      color: aquamarine;
      font-family: "Times New Roman", Times, serif;
    }

    .google-btn {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 10px 20px;
      background-color: white;
      color: #555;
      border: 1px solid #ccc;
      border-radius: 30px;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .google-btn img {
      height: 20px;
      width: 20px;
    }

    .google-btn:hover {
      background-color: #f1f1f1;
      transform: scale(1.03);
    }

    #sign-button {
      margin-top: 1rem;
    }

    #user-info {
      display: none;
      margin-top: 1rem;
    }

    .counter {
      margin-top: 1rem;
      font-weight: bold;
      color: #333;
    }

    .sign-button {
      color: #f84d64;
      background-color: cadetblue;
      font-family: "Times New Roman", Times, serif;
    }

    #logout-btn {
      background-color: darkred;
      margin-top: 1rem;
    }

    .counter{
      font-family:"Times New Roman", Times, serif ;
      color:crimson;

    }
  </style>
</head>
<body>
 
  
 
  
    
  </div>

  <div class="header"></div>

  <div class="container">
    <h1>Stand with Afghan Women</h1>
    <img src="download.jpg" class="imgsrc" alt="Support Afghan Women">
    <strong><em><p>Sign the petition to support access to education, safety, and basic human rights for women in Afghanistan.</p></em></strong>

    <div id="sign-button">
      <button class="google-btn" onclick="signIn()">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google logo" />
        <span>Sign in with Google</span>
      </button>
    </div>

    <div id="user-info">
      <p><strong>Welcome, <span id="user-name"></span>!</strong></p>
      <button onclick="submitPetition()">Sign the Petition</button>
      <p id="thank-you" style="color:green; display:none;">✔️ Thank you for signing!</p>
      <button id="logout-btn" onclick="signOut()">Log Out</button>
    </div>

    <div class="counter">Total Signatures: <span id="signature-count">Loading...</span></div>
  </div>

  <button onclick="window.location.href='index.html'">Go back to principal page!</button>

  <div class="container">
    <h1>Statistics</h1>
    <canvas id="votesChart" width="400" height="200"></canvas>


  
</div>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCO3P22JvH5a8xQzQiuaemEki-95SRcEk0",
      authDomain: "support-women-in-afghanistan.firebaseapp.com",
      projectId: "support-women-in-afghanistan",
      storageBucket: "support-women-in-afghanistan.appspot.com",
      messagingSenderId: "326584491208",
      appId: "1:326584491208:web:8ff4a4ca7570ccf1c219fd",
      measurementId: "G-N8BP4DVWL6"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function signIn() {
      google.accounts.id.initialize({
        client_id: '326584491208-n0bl7j0t7uu0t43fsknfi2sd4ublgcv4.apps.googleusercontent.com',
        callback: handleCredentialResponse
      });

      google.accounts.id.prompt();
    }

    function handleCredentialResponse(response) {
      const data = jwt_decode(response.credential);
      document.getElementById('user-name').textContent = data.name;

      const credential = firebase.auth.GoogleAuthProvider.credential(response.credential);
      firebase.auth().signInWithCredential(credential)
        .then((userCredential) => {
          document.getElementById('sign-button').style.display = 'none';
          document.getElementById('user-info').style.display = 'block';
        })
        .catch((error) => {
          console.error('Login failed:', error);
          alert('Login error. Try again!');
        });
    }

    function submitPetition() {
      const user = firebase.auth().currentUser;
      if (user) {
        db.collection('signatures').doc(user.uid).set({
          name: user.displayName,
          email: user.email,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        }).then(() => {
          document.getElementById('thank-you').style.display = 'block';
          updateSignatureCount();
        }).catch(error => {
          console.error('Error saving signature:', error);
        });
      }
    }

    function signOut() {
      firebase.auth().signOut().then(() => {
        location.reload();
      });
    }

    function updateSignatureCount() {
      db.collection('signatures').get().then(snapshot => {
        document.getElementById('signature-count').textContent = snapshot.size;
      });
    }

    // Update counter on load
    updateSignatureCount();

    function updateGenderChart() {
  db.collection('signatures').get().then(snapshot => {
    let counts = { male: 0, female: 0, other: 0 };

    snapshot.forEach(doc => {
      const gender = doc.data().gender || 'other';
      counts[gender] = (counts[gender] || 0) + 1;
    });

    const ctx = document.getElementById('genderChart').getContext('2d');
    new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['Female', 'Male', 'Other'],
        datasets: [{
          data: [counts.female, counts.male, counts.other],
          backgroundColor: ['#f84d64', '#36a2eb', '#ffce56'],
          borderColor: '#fff',
          borderWidth: 2
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: 'bottom'
          },
          title: {
            display: true,
            text: 'Gender Distribution of Petition Signers'
          }
        }
      }
    });
  });
}

// Apel după ce se semnează sau la încărcare
updateGenderChart();

function updateGenderChart() {
  db.collection('signatures').get().then(snapshot => {
    let counts = { male: 0, female: 0, other: 0 };

    snapshot.forEach(doc => {
      const gender = doc.data().gender || 'other';
      counts[gender] = (counts[gender] || 0) + 1;
    });

    const ctx = document.getElementById('genderChart').getContext('2d');
    new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['Female', 'Male', 'Other'],
        datasets: [{
          data: [counts.female, counts.male, counts.other],
          backgroundColor: ['#f84d64', '#36a2eb', '#ffce56'],
          borderColor: '#fff',
          borderWidth: 2
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: 'bottom'
          },
          title: {
            display: true,
            text: 'Gender Distribution of Petition Signers'
          }
        }
      }
    });
  });
}
function updateMap() {
  const map = L.map('map').setView([44.43, 26.10], 6); // Locație inițială (București)

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
  }).addTo(map);

  db.collection('signatures').get().then(snapshot => {
    snapshot.forEach(doc => {
      const data = doc.data();
      const location = data.location.split(", ");
      const lat = parseFloat(location[0]);
      const lng = parseFloat(location[1]);

      L.marker([lat, lng]).addTo(map)
        .bindPopup(`<b>${data.name}</b><br>${data.email}<br>${data.gender}`)
        .openPopup();
    });
  });
}

// Apelăm funcția pentru a încărca harta cu semnături
updateMap();

let votesChart;

function updateVotesChart() {
  db.collection('votes').get().then(snapshot => {
    let voteCounts = { optionA: 0, optionB: 0, optionC: 0 };

    snapshot.forEach(doc => {
      const vote = doc.data().vote; // Aici presupunem că "vote" conține opțiunea aleasă
      if (vote === 'optionA') voteCounts.optionA++;
      if (vote === 'optionB') voteCounts.optionB++;
      if (vote === 'optionC') voteCounts.optionC++;
    });

    // Dacă graficul nu există, îl creăm
    if (!votesChart) {
      const ctx = document.getElementById('votesChart').getContext('2d');
      votesChart = new Chart(ctx, {
        type: 'bar', // Tipul graficului
        data: {
          labels: ['Option A', 'Option B', 'Option C'], // Etichetele opțiunilor
          datasets: [{
            label: 'Number of Votes', // Eticheta axei Y
            data: [voteCounts.optionA, voteCounts.optionB, voteCounts.optionC], // Numărul de voturi pentru fiecare opțiune
            backgroundColor: ['#ff5733', '#33ff57', '#3357ff'], // Culoare pentru fiecare bară
            borderColor: '#fff', // Culoarea marginii barei
            borderWidth: 2 // Lățimea marginii
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true, // Asigură-te că axa Y începe de la 0
              ticks: {
                stepSize: 1 // Setează pașii de creștere pe axa Y
              }
            }
          },
          plugins: {
            legend: {
              position: 'top'
            },
            title: {
              display: true,
              text: 'Voting Distribution'
            }
          }
        }
      });
    } else {
      // Actualizează datele graficei existente
      votesChart.data.datasets[0].data = [voteCounts.optionA, voteCounts.optionB, voteCounts.optionC];
      votesChart.update(); // Actualizează graficul
    }
  }).catch(error => {
    console.error('Error fetching votes:', error);
  });
}

// Apelăm funcția pentru a actualiza graficul la fiecare modificare de vot
db.collection('votes').onSnapshot(snapshot => {
  updateVotesChart();
});

function submitVote(selectedOption) {
  const user = firebase.auth().currentUser;

  if (user) {
    db.collection('votes').doc(user.uid).set({
      vote: selectedOption,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    }).then(() => {
      updateVotesChart(); // Actualizează graficul când este adăugat un vot
    }).catch(error => {
      console.error('Error submitting vote:', error);
    });
  }
}
document.getElementById('signButton').addEventListener('click', function() {
    alert("Thank you for signing the petition!");
});
document.getElementById('thankYouMessage').style.display = 'block';

function signPetition() {
    document.getElementById('loadingMessage').style.display = 'block'; // Arată mesajul de încărcare
    // Cod pentru a trimite semnătura la server (de exemplu, Firebase)
    
    firebase.firestore().collection('petitions').add({
        user: firebase.auth().currentUser.uid,
        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
    })
    .then(() => {
        document.getElementById('loadingMessage').style.display = 'none'; // Ascunde mesajul de încărcare
        document.getElementById('thankYouMessage').style.display = 'block'; // Afișează mesajul de mulțumire
    })
    .catch((error) => {
        console.error("Error signing petition: ", error);
        document.getElementById('loadingMessage').style.display = 'none';
        alert('Something went wrong, please try again.');
    });
}

  </script>
</body>
</html>
